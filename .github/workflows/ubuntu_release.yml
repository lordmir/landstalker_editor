name: build-release

on:
  push
  release

jobs:
  build-release:
    name: Linux release build
    runs-on: ubuntu-20.04
    env:
      BUILD_TYPE: Release
    strategy:
      fail-fast: false

    steps:
      â€“ uses: actions/checkout@v3

      - name: Install Dependencies
        shell: bash
        working-directory: ${{github.workspace}}/wxwidgets
        run: |
             sudo apt-get install -y \
                gcc-11
                g++-11
                build-essentials
                libgtk-3-dev
                libgl1-mesa-dev
                libglu1-mesa-dev
                libgstreamer-plugins-base1.0-dev
                libcurl4-openssl-dev
                libwebkit2gtk-4.0-dev
                libpng-dev

      - uses: actions/checkout@v3
        with:
          repository: wxWidgets/wxWidgets
          ref: refs/heads/3.2.2-hotfix
          path: wxwidgets
        shell: bash
        working-directory: ${{github.workspace}}/wxwidgets
        run: mkdir gtkbuild

      - name: Configure wxWidgets
        working-directory: ${{github.workspace}}/wxwidgets/gtkbuild
        shell: bash
        run: ../configure --with-gtk --disable-shared

      - name: Build wxWidgets
        working-directory: ${{github.workspace}}/wxwidgets/gtkbuild
        shell: bash
        run: make -j8

      - name: Install wxWidgets
        working-directory: ${{github.workspace}}/wxwidgets/gtkbuild
        shell: bash
        run: | 
            sudo make install
            sudo ldconfig

      - name: Build Landstalker Editor
        working-directory: ${{github.workspace}}/
        shell: bash
        run: make -j8

      - name: Compress artifacts
        working-directory: ${{github.workspace}}/
        shell: bash
        run: tar zxcf landstalker_editor.tar.gz landstalker_editor

      - name: Archive build
        uses: actions/upload-artifact@v3
        with:
          name: landstalker_editor_binary
          path: ./landstalker_editor.tar.gz
